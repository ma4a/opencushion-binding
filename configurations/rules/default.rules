import org.openhab.core.library.types.*
import org.openhab.core.persistence.*
import org.openhab.model.script.actions.*

var Timer timer = null
var int l_time = 10

rule "duration changend"
when
	Item duration received update
then
	l_time = (duration.state as DecimalType).intValue
end

rule "timer cushen"
when
	Item weight received update
then
	
	var Number weight_st = weight.state as DecimalType
	if(weight_st > 2.0) {
		postUpdate(sitzt, "Ja")
		if(timer==null) {
			// first ON command, so create a timer to turn the light off again
			timer = createTimer(now.plusSeconds(l_time)) [|
				postUpdate(alarm, "ON")
				playSound("doorbell.mp3")
				postUpdate(networkLamp_A,"ON")
			]
		}
	} else {
		postUpdate(sitzt, "Nein")
		if(timer!=null) {
			postUpdate(alarm, "OFF")
			timer.cancel
			timer = null
			postUpdate(networkLamp_A,"OFF")
		}	
	}
end
